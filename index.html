<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Leaf Blower Cat Chaser</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow: hidden;
    }
    canvas { cursor: none; display: block; }
  </style>
</head>
<body>
<canvas id="game"></canvas>
<script>
// â”€â”€â”€ Setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvas = document.getElementById('game');
const ctx    = canvas.getContext('2d');
const W = canvas.width  = 800;
const H = canvas.height = 600;

// Scale canvas to fit viewport
function resize() {
  const s = Math.min(window.innerWidth / W, window.innerHeight / H, 1);
  canvas.style.width  = (W * s) + 'px';
  canvas.style.height = (H * s) + 'px';
}
resize();
window.addEventListener('resize', resize);

// â”€â”€â”€ Constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PX = W / 2, PY = H / 2;          // player position (fixed)
const WIND_RANGE      = 230;
const WIND_HALF_ANGLE = 0.30;           // ~17 deg each side
const MAX_CATS        = 10;

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let mouse       = { x: PX + 150, y: PY };
let playerAngle = 0;
let particles   = [];
let cats        = [];
let popups      = [];   // floating "+1" text
let score       = 0;
let spawnTimer  = 0;
let frame       = 0;

// â”€â”€â”€ Pre-render grass â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const grassCanvas = document.createElement('canvas');
grassCanvas.width = W; grassCanvas.height = H;
const gc = grassCanvas.getContext('2d');
(function buildGrass() {
  gc.fillStyle = '#4a8c5c';
  gc.fillRect(0, 0, W, H);
  for (let x = 0; x < W; x += 50)
    for (let y = 0; y < H; y += 50)
      if ((Math.floor(x/50) + Math.floor(y/50)) % 2 === 0) {
        gc.fillStyle = '#428054';
        gc.fillRect(x, y, 50, 50);
      }
  // grass tufts
  gc.strokeStyle = '#3a6e48';
  gc.lineWidth   = 1.5;
  for (let i = 0; i < 350; i++) {
    const tx = Math.random() * W, ty = Math.random() * H;
    gc.save();
    gc.translate(tx, ty);
    for (let b = 0; b < 3; b++) {
      gc.save();
      gc.rotate((b - 1) * 0.35);
      gc.beginPath();
      gc.moveTo(0, 0); gc.lineTo(0, -7);
      gc.stroke();
      gc.restore();
    }
    gc.restore();
  }
})();

// â”€â”€â”€ Particle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class Particle {
  constructor(x, y, baseAngle) {
    this.x = x; this.y = y;
    const spread = (Math.random() - 0.5) * WIND_HALF_ANGLE * 2;
    const spd    = 7 + Math.random() * 6;
    this.vx   = Math.cos(baseAngle + spread) * spd;
    this.vy   = Math.sin(baseAngle + spread) * spd;
    this.life  = 1.0;
    this.decay = 0.022 + Math.random() * 0.022;
    this.r     = 1.5 + Math.random() * 2.5;
    this.hue   = 185 + Math.random() * 35;
  }
  update() {
    this.x += this.vx; this.y += this.vy;
    this.vx *= 0.96;   this.vy *= 0.96;
    this.life -= this.decay;
  }
  draw() {
    ctx.globalAlpha = this.life * 0.75;
    ctx.fillStyle   = `hsl(${this.hue},80%,82%)`;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.r * this.life, 0, Math.PI * 2);
    ctx.fill();
    ctx.globalAlpha = 1;
  }
  get dead() { return this.life <= 0; }
}

// â”€â”€â”€ Popup text â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class Popup {
  constructor(x, y, text) {
    this.x = x; this.y = y; this.text = text;
    this.life = 1.0;
  }
  update() { this.y -= 1.2; this.life -= 0.025; }
  draw() {
    ctx.globalAlpha = this.life;
    ctx.fillStyle   = '#fff';
    ctx.strokeStyle = '#000';
    ctx.lineWidth   = 3;
    ctx.font        = 'bold 22px Arial';
    ctx.textAlign   = 'center';
    ctx.strokeText(this.text, this.x, this.y);
    ctx.fillText(this.text,   this.x, this.y);
    ctx.textAlign   = 'left';
    ctx.globalAlpha = 1;
  }
  get dead() { return this.life <= 0; }
}

// â”€â”€â”€ Cat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COATS = [
  { body: '#c8883c', ear: '#a0622c' },  // orange tabby
  { body: '#888',    ear: '#666'    },  // gray
  { body: '#e8d8b0', ear: '#c0b080' },  // cream
  { body: '#2a2a2a', ear: '#111'    },  // black
  { body: '#c0784a', ear: '#9a5832' },  // ginger
];

class Cat {
  constructor() {
    // spawn from a random edge
    const side = Math.floor(Math.random() * 4);
    if      (side === 0) { this.x = Math.random() * W; this.y = -35; }
    else if (side === 1) { this.x = W + 35; this.y = Math.random() * H; }
    else if (side === 2) { this.x = Math.random() * W; this.y = H + 35; }
    else                 { this.x = -35; this.y = Math.random() * H; }

    const coat    = COATS[Math.floor(Math.random() * COATS.length)];
    this.bodyClr  = coat.body;
    this.earClr   = coat.ear;
    this.sz       = 16 + Math.random() * 5;
    this.wobble   = Math.random() * Math.PI * 2;

    // initial velocity aimed loosely at centre
    const dx = PX - this.x, dy = PY - this.y;
    const d  = Math.hypot(dx, dy);
    const spd = 0.55 + Math.random() * 0.4;
    this.vx = dx/d * spd;
    this.vy = dy/d * spd;
    this.wanderAngle = Math.atan2(dy, dx);

    this.scared      = false;
    this.scaredTimer = 0;
    this.exclamTimer = 0;   // show "!" on first scare
  }

  get facing() { return Math.atan2(this.vy, this.vx); }

  update() {
    this.wobble += 0.12;
    if (this.scared) {
      this.scaredTimer--;
      this.exclamTimer--;
      if (this.scaredTimer <= 0) this.scared = false;
      this.vx *= 0.975; this.vy *= 0.975;
    } else {
      this.wanderAngle += (Math.random() - 0.5) * 0.09;
      this.vx += Math.cos(this.wanderAngle) * 0.06;
      this.vy += Math.sin(this.wanderAngle) * 0.06;
      const sp = Math.hypot(this.vx, this.vy);
      if (sp > 1.6) { this.vx = this.vx/sp * 1.6; this.vy = this.vy/sp * 1.6; }
      // soft walls while calm
      if (this.x < 40)     this.vx += 0.12;
      if (this.x > W - 40) this.vx -= 0.12;
      if (this.y < 40)     this.vy += 0.12;
      if (this.y > H - 40) this.vy -= 0.12;
    }
    this.x += this.vx; this.y += this.vy;
  }

  applyWind(wx, wy, force) {
    const wasScared = this.scared;
    this.vx += wx * force * 7;
    this.vy += wy * force * 7;
    const sp = Math.hypot(this.vx, this.vy);
    if (sp > 13) { this.vx = this.vx/sp * 13; this.vy = this.vy/sp * 13; }
    this.scared      = true;
    this.scaredTimer = 100;
    if (!wasScared) this.exclamTimer = 40;
  }

  isGone() {
    return this.x < -90 || this.x > W+90 || this.y < -90 || this.y > H+90;
  }

  draw() {
    const s = this.sz;
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.facing);

    // tail
    ctx.save();
    ctx.strokeStyle = this.bodyClr;
    ctx.lineWidth   = s * 0.28;
    ctx.lineCap     = 'round';
    const tw = Math.sin(this.wobble) * s * 0.8;
    ctx.beginPath();
    ctx.moveTo(-s * 0.85, 0);
    ctx.quadraticCurveTo(-s * 1.6, tw, -s * 2.1, tw * 0.4);
    ctx.stroke();
    ctx.restore();

    // body
    ctx.fillStyle = this.bodyClr;
    ctx.beginPath();
    ctx.ellipse(0, 0, s, s * 0.72, 0, 0, Math.PI * 2);
    ctx.fill();

    // head
    ctx.beginPath();
    ctx.arc(s * 0.85, 0, s * 0.65, 0, Math.PI * 2);
    ctx.fill();

    // ears
    ctx.fillStyle = this.earClr;
    [[- 1], [1]].forEach(([sy]) => {
      ctx.beginPath();
      ctx.moveTo(s * 0.52, sy * s * 0.38);
      ctx.lineTo(s * 0.78, sy * s * 0.92);
      ctx.lineTo(s * 1.08, sy * s * 0.42);
      ctx.closePath();
      ctx.fill();
    });

    // inner ear
    ctx.fillStyle = 'rgba(255,150,150,0.4)';
    [[-1],[1]].forEach(([sy]) => {
      ctx.beginPath();
      ctx.moveTo(s * 0.58, sy * s * 0.40);
      ctx.lineTo(s * 0.78, sy * s * 0.78);
      ctx.lineTo(s * 1.02, sy * s * 0.46);
      ctx.closePath();
      ctx.fill();
    });

    // eyes
    if (this.scared) {
      ctx.strokeStyle = '#f55';
      ctx.lineWidth   = 1.5;
      [[-0.22],[0.22]].forEach(([ey]) => {
        ctx.beginPath();
        ctx.arc(s * 0.85, s * ey, 4, 0, Math.PI * 2);
        ctx.stroke();
        ctx.fillStyle = '#111';
        ctx.beginPath();
        ctx.arc(s * 0.85, s * ey, 1.8, 0, Math.PI * 2);
        ctx.fill();
      });
    } else {
      ctx.fillStyle = '#222';
      [[-0.22],[0.22]].forEach(([ey]) => {
        ctx.beginPath();
        ctx.ellipse(s * 0.85, s * ey, 2, 3.5, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(s * 0.85 + 1, s * ey - 1.2, 1, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    // whiskers
    ctx.strokeStyle = 'rgba(255,255,255,0.55)';
    ctx.lineWidth   = 0.8;
    [[-1],[1]].forEach(([sy]) => {
      ctx.beginPath();
      ctx.moveTo(s * 0.72, sy * s * 0.05);
      ctx.lineTo(s * 1.38, sy * s * 0.20);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(s * 0.72, 0);
      ctx.lineTo(s * 1.42, 0);
      ctx.stroke();
    });

    // exclamation mark on first scare
    if (this.exclamTimer > 0) {
      const alpha = Math.min(1, this.exclamTimer / 15);
      ctx.globalAlpha = alpha;
      ctx.fillStyle   = '#ffe04a';
      ctx.strokeStyle = '#000';
      ctx.lineWidth   = 2;
      ctx.font        = `bold ${Math.round(s)}px Arial`;
      ctx.textAlign   = 'center';
      ctx.strokeText('!', 0, -s * 2);
      ctx.fillText('!',   0, -s * 2);
      ctx.textAlign   = 'left';
      ctx.globalAlpha = 1;
    }

    ctx.restore();
  }
}

// â”€â”€â”€ Draw player â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawPlayer() {
  ctx.save();
  ctx.translate(PX, PY);
  ctx.rotate(playerAngle);

  // shadow
  ctx.fillStyle = 'rgba(0,0,0,0.18)';
  ctx.beginPath();
  ctx.ellipse(2, 4, 26, 10, 0, 0, Math.PI * 2);
  ctx.fill();

  // legs
  ctx.fillStyle = '#3355bb';
  ctx.beginPath(); ctx.ellipse(-7, -11, 6, 13, -0.2, 0, Math.PI * 2); ctx.fill();
  ctx.beginPath(); ctx.ellipse(-7,  11, 6, 13,  0.2, 0, Math.PI * 2); ctx.fill();

  // shoes
  ctx.fillStyle = '#222';
  ctx.beginPath(); ctx.ellipse(-15, -11, 7, 4, -0.15, 0, Math.PI * 2); ctx.fill();
  ctx.beginPath(); ctx.ellipse(-15,  11, 7, 4,  0.15, 0, Math.PI * 2); ctx.fill();

  // torso
  ctx.fillStyle = '#e07030';
  ctx.beginPath(); ctx.ellipse(0, 0, 18, 14, 0, 0, Math.PI * 2); ctx.fill();

  // arms
  ctx.fillStyle = '#f0b880';
  ctx.beginPath(); ctx.ellipse(11, -13, 5, 12,  0.3, 0, Math.PI * 2); ctx.fill();
  ctx.beginPath(); ctx.ellipse(11,  13, 5, 12, -0.3, 0, Math.PI * 2); ctx.fill();

  // leaf-blower body
  ctx.fillStyle = '#aaa';
  ctx.beginPath(); ctx.roundRect(4, -7, 40, 14, 4); ctx.fill();
  // engine bump
  ctx.fillStyle = '#888';
  ctx.beginPath(); ctx.roundRect(10, -12, 18, 6, 3); ctx.fill();
  // handle
  ctx.fillStyle = '#666';
  ctx.beginPath(); ctx.roundRect(18, 7, 14, 8, 2); ctx.fill();
  // nozzle cone
  ctx.fillStyle = '#666';
  ctx.beginPath();
  ctx.moveTo(42, -6); ctx.lineTo(58, -9); ctx.lineTo(58, 9); ctx.lineTo(42, 6);
  ctx.closePath();
  ctx.fill();
  // nozzle ring
  ctx.strokeStyle = '#444';
  ctx.lineWidth   = 2;
  ctx.beginPath(); ctx.moveTo(58, -9); ctx.lineTo(58, 9); ctx.stroke();

  // head
  ctx.fillStyle = '#f0b880';
  ctx.beginPath(); ctx.arc(20, 0, 14, 0, Math.PI * 2); ctx.fill();
  // hair
  ctx.fillStyle = '#4a2e10';
  ctx.beginPath(); ctx.ellipse(20, -6, 14, 10, 0, Math.PI, 0); ctx.fill();
  // eye
  ctx.fillStyle = '#222';
  ctx.beginPath(); ctx.arc(25, -2, 2.5, 0, Math.PI * 2); ctx.fill();
  ctx.fillStyle = '#fff';
  ctx.beginPath(); ctx.arc(26, -3, 1, 0, Math.PI * 2); ctx.fill();
  // smile
  ctx.strokeStyle = '#a04025';
  ctx.lineWidth   = 1.8;
  ctx.beginPath(); ctx.arc(25, 3, 4, 0.1, Math.PI - 0.1); ctx.stroke();

  ctx.restore();
}

// â”€â”€â”€ Wind cone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawWindCone() {
  const ox = PX + Math.cos(playerAngle) * 60;
  const oy = PY + Math.sin(playerAngle) * 60;
  const ex = PX + Math.cos(playerAngle) * WIND_RANGE;
  const ey = PY + Math.sin(playerAngle) * WIND_RANGE;

  const grad = ctx.createLinearGradient(ox, oy, ex, ey);
  grad.addColorStop(0, 'rgba(180,230,255,0.38)');
  grad.addColorStop(1, 'rgba(180,230,255,0.0)');
  ctx.fillStyle = grad;

  ctx.beginPath();
  ctx.moveTo(ox, oy);
  ctx.lineTo(
    PX + Math.cos(playerAngle + WIND_HALF_ANGLE) * WIND_RANGE,
    PY + Math.sin(playerAngle + WIND_HALF_ANGLE) * WIND_RANGE
  );
  ctx.lineTo(
    PX + Math.cos(playerAngle - WIND_HALF_ANGLE) * WIND_RANGE,
    PY + Math.sin(playerAngle - WIND_HALF_ANGLE) * WIND_RANGE
  );
  ctx.closePath();
  ctx.fill();
}

// â”€â”€â”€ Wind â†’ cats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function applyWind() {
  for (const cat of cats) {
    const dx   = cat.x - PX, dy = cat.y - PY;
    const dist = Math.hypot(dx, dy);
    if (dist < WIND_RANGE && dist > 22) {
      let diff = Math.atan2(dy, dx) - playerAngle;
      while (diff >  Math.PI) diff -= Math.PI * 2;
      while (diff < -Math.PI) diff += Math.PI * 2;
      if (Math.abs(diff) < WIND_HALF_ANGLE) {
        cat.applyWind(
          Math.cos(playerAngle),
          Math.sin(playerAngle),
          (1 - dist / WIND_RANGE)
        );
      }
    }
  }
}

// â”€â”€â”€ HUD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawHUD() {
  // score
  ctx.fillStyle = 'rgba(0,0,0,0.5)';
  ctx.beginPath(); ctx.roundRect(12, 12, 215, 50, 8); ctx.fill();
  ctx.fillStyle = '#fff';
  ctx.font      = 'bold 21px Arial';
  ctx.fillText(`Cats Scared Away: ${score}`, 22, 44);

  // on-screen count
  ctx.fillStyle = 'rgba(0,0,0,0.4)';
  ctx.beginPath(); ctx.roundRect(12, 68, 170, 30, 6); ctx.fill();
  ctx.fillStyle = '#ccc';
  ctx.font      = '14px Arial';
  ctx.fillText(`On screen: ${cats.length} / ${MAX_CATS}`, 22, 88);

  // instructions (fade out after 5 s)
  if (frame < 320) {
    const a = Math.min(1, (320 - frame) / 80);
    ctx.globalAlpha = a;
    ctx.fillStyle   = 'rgba(0,0,0,0.55)';
    ctx.beginPath(); ctx.roundRect(W/2 - 195, H - 58, 390, 42, 8); ctx.fill();
    ctx.fillStyle   = '#fff';
    ctx.font        = '16px Arial';
    ctx.textAlign   = 'center';
    ctx.fillText('Move your mouse to aim the leaf blower and scare cats away!', W/2, H - 30);
    ctx.textAlign   = 'left';
    ctx.globalAlpha = 1;
  }
}

// â”€â”€â”€ Cursor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawCursor() {
  ctx.save();
  ctx.translate(mouse.x, mouse.y);
  ctx.strokeStyle = 'rgba(255,255,255,0.85)';
  ctx.lineWidth   = 1.5;
  ctx.beginPath();
  ctx.moveTo(-9, 0); ctx.lineTo(9, 0);
  ctx.moveTo(0, -9); ctx.lineTo(0, 9);
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(0, 0, 5, 0, Math.PI * 2);
  ctx.stroke();
  ctx.restore();
}

// â”€â”€â”€ Game loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loop() {
  frame++;

  // Update player aim
  playerAngle = Math.atan2(mouse.y - PY, mouse.x - PX);

  // Emit particles from nozzle tip
  const nozzleX = PX + Math.cos(playerAngle) * 60;
  const nozzleY = PY + Math.sin(playerAngle) * 60;
  for (let i = 0; i < 4; i++)
    particles.push(new Particle(nozzleX, nozzleY, playerAngle));

  // Spawn cats â€” difficulty ramps slowly
  spawnTimer++;
  const interval = Math.max(55, 140 - score * 4);
  if (spawnTimer >= interval && cats.length < MAX_CATS) {
    cats.push(new Cat());
    spawnTimer = 0;
  }

  // Update
  for (const p of particles) p.update();
  particles = particles.filter(p => !p.dead);

  for (const c of cats) c.update();
  applyWind();

  for (const p of popups) p.update();
  popups = popups.filter(p => !p.dead);

  // Remove cats that fled off-screen
  const before = cats.length;
  cats = cats.filter(c => {
    if (c.isGone()) {
      popups.push(new Popup(
        Math.max(30, Math.min(W - 30, c.x)),
        Math.max(30, Math.min(H - 30, c.y)),
        '+1 ðŸ˜¸'
      ));
      return false;
    }
    return true;
  });
  score += before - cats.length;

  // â”€â”€ Draw â”€â”€
  ctx.drawImage(grassCanvas, 0, 0);
  drawWindCone();
  for (const p of particles) p.draw();
  for (const c of cats)      c.draw();
  drawPlayer();
  for (const p of popups)    p.draw();
  drawHUD();
  drawCursor();

  requestAnimationFrame(loop);
}

// â”€â”€â”€ Input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
canvas.addEventListener('mousemove', e => {
  const r  = canvas.getBoundingClientRect();
  const sx = canvas.width  / r.width;
  const sy = canvas.height / r.height;
  mouse.x  = (e.clientX - r.left) * sx;
  mouse.y  = (e.clientY - r.top)  * sy;
});

// â”€â”€â”€ Go â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loop();
</script>
</body>
</html>
